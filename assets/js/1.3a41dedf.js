(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{50:function(t,s,a){"use strict";a.r(s);var n=a(0),o=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"在树莓派上部署git服务gogs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在树莓派上部署git服务gogs","aria-hidden":"true"}},[t._v("#")]),t._v(" 在树莓派上部署git服务gogs")]),a("p",[a("a",{attrs:{href:"https://gogs.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gogs")]),t._v("是一款极易搭建的自助git服务。相对于Gitlab等git服务，gogs有易安装、跨平台、轻量级的特性。gogs在树莓派上也能很流畅的运行，对于小型开发团队极其适用。")]),a("p",[t._v("本文主要介绍gogs在树莓派上的搭建过程。")]),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),a("p",[t._v("git 服务版本>1.7.1")]),a("p",[t._v("本文使用sqlite3作为数据库，不需要安装")]),a("p",[t._v("安装nginx（不需要反向代理可以不装）")])]),a("h2",{attrs:{id:"安装go语言环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装go语言环境","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装go语言环境")]),a("p",[t._v("这里选择源码方式安装。")]),a("p",[t._v("首先需要安装编译go的编译器。")]),a("h3",{attrs:{id:"安装go编译器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装go编译器","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装go编译器")]),a("p",[t._v("首先下载"),a("a",{attrs:{href:"https://dl.google.com/go/go1.4-bootstrap-20171003.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[t._v("go1.4-bootstrap")]),t._v("，放到用户根目录下解压缩。")]),a("p",[t._v("然后需要设备go编译器的环境变量，默认情况下路径是根目录下的"),a("code",[t._v("go1.4")]),t._v("目录，所以只需要修改解压缩后的文件见名称为"),a("code",[t._v("go1.4")]),t._v("即可。如果需要放到其他目录，记得设置"),a("code",[t._v("GOROOT_BOOTSTRAP")]),t._v("环境变量到编译器目录。")]),a("h3",{attrs:{id:"安装go语言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装go语言","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装go语言")]),a("p",[t._v("下载"),a("a",{attrs:{href:"https://dl.google.com/go/go1.10.2.src.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[t._v("go1.10.2.src")]),t._v("源码并解压缩到用户根目录。")]),a("p",[t._v("运行以下命令，等待编译完成。")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" go/src\n$ ./all.bash\n")])]),a("p",[t._v("编译完成后，需要设置go的执行路径到环境变量，也就是把"),a("code",[t._v("go/bin")]),t._v("路径添加到环境变量中。")]),a("p",[t._v("示例如下，添加以下内容到用户根目录的"),a("code",[t._v(".bashrc")]),t._v("文件中。")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("export")]),t._v(" GOROOT"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token variable"}},[t._v("$HOME")]),t._v("/go\n"),a("span",{attrs:{class:"token function"}},[t._v("export")]),t._v(" PATH"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token variable"}},[t._v("$PATH")]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),a("span",{attrs:{class:"token variable"}},[t._v("$GOROOT")]),t._v("/bin\n")])]),a("p",[t._v("运行"),a("code",[t._v("source .bashrc")]),t._v("命令使环境变量生效。")]),a("p",[t._v("测试一下。")]),a("p",[t._v("创建"),a("code",[t._v("hello.go")]),t._v("文件，填入以下内容")]),a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("main")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fmt"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("Printf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"hello, world\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("p",[t._v("运行"),a("code",[t._v("go run hello.go")]),t._v("命令，看到"),a("code",[t._v("hello， world")]),t._v("的话就算安装完成了。")]),a("h2",{attrs:{id:"安装gogs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装gogs","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装gogs")]),a("p",[t._v("gogs我们采用二进制安装的方式，官网提供了支持树莓派的安装包。")]),a("p",[t._v("首先下载"),a("a",{attrs:{href:"https://dl.gogs.io/0.11.43/gogs_0.11.43_raspi2_armv6.zip",target:"_blank",rel:"noopener noreferrer"}},[t._v("gogs安装包")]),t._v("并解压缩到用户根目录。\n然后就安装完成了。")]),a("h2",{attrs:{id:"运行gogs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行gogs","aria-hidden":"true"}},[t._v("#")]),t._v(" 运行gogs")]),a("p",[t._v("运行以下命令")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" gogs\n$ ./gogs web\n")])]),a("p",[t._v("gogs就运行起来了，直接在浏览器访问树莓派地址加3000端口号，就可以看到gogs的初始化界面。")]),a("h2",{attrs:{id:"配置gogs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置gogs","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置gogs")]),a("p",[t._v("gogs自带默认的配置，用户自定义配置是gogs目录下的"),a("code",[t._v("custom/conf/app.ini")]),t._v("文件。")]),a("p",[t._v("我们需要配置有"),a("code",[t._v("ROOT")]),t._v("、"),a("code",[t._v("RUN_USER")]),t._v("、"),a("code",[t._v("DB_TYPE")]),t._v("、"),a("code",[t._v("DOMAIN")]),t._v("、"),a("code",[t._v("ROOT_URL")]),t._v("、"),a("code",[t._v("START_SSH_SERVER")]),t._v("、"),a("code",[t._v("SSH_LISTEN_HOST")]),t._v("、"),a("code",[t._v("SSH_LISTEN_PORT")]),t._v("。")]),a("p",[a("code",[t._v("ROOT")]),t._v("代表git仓库的根路径。")]),a("p",[a("code",[t._v("RUN_USER")]),t._v("表示当前运行gogs的用户名，由于raspberry默认用户是"),a("code",[t._v("pi")]),t._v(",为了不增加复杂度，我们设置为"),a("code",[t._v("pi")]),t._v("。")]),a("p",[a("code",[t._v("DB_TYPE")]),t._v("表示数据库类型，此处设置成"),a("code",[t._v("sqlite3")]),t._v("。")]),a("p",[a("code",[t._v("DOMAIN")]),t._v("代表访问gogs的域名，如果只在内网访问，可以设置成树莓派的主机名"),a("code",[t._v("raspberrypi")]),t._v("，在外网访问的话就需要设置成域名，我的域名是"),a("code",[t._v("git.gdzrch.win")]),t._v("。")]),a("p",[a("code",[t._v("ROOT_URL")]),t._v("代表gogs的web界面访问地址，需要完整的url，例如"),a("code",[t._v("http://git.gdzrch.win")]),t._v("。")]),a("p",[a("code",[t._v("START_SSH_SERVER")]),t._v("表示开始gogs内置的ssh服务，不使用树莓派的ssh服务，为了更方便的处理，此处我们使用内置的ssh服务。")]),a("p",[a("code",[t._v("SSH_LISTEN_PORT")]),t._v("表示内置ssh服务的监听端口，由于树莓派的ssh服务默认占用22端口，所以我们需要监听别的端口，比如"),a("code",[t._v("2022")]),t._v("。当然你也可以修改树莓派ssh服务的默认端口，让gogs内置的ssh服务使用22端口。此处我们使用"),a("code",[t._v("2022")]),t._v("端口。")]),a("p",[a("code",[t._v("SSH_LISTEN_HOST")]),t._v("是内置ssh服务的监听地址，设置为"),a("code",[t._v("0.0.0.0")]),t._v("表示所有的地址都可以访问。")]),a("p",[t._v("示例配置如下")]),a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{attrs:{class:"token constant"}},[t._v("RUN_USER")]),t._v(" "),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" pi")]),t._v("\n\n"),a("span",{attrs:{class:"token selector"}},[t._v("[database]")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("DB_TYPE")]),t._v("  "),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" sqlite3")]),t._v("\n\n"),a("span",{attrs:{class:"token selector"}},[t._v("[repository]")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("ROOT")]),t._v(" "),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" /home/pi/gogs-repositories")]),t._v("\n\n"),a("span",{attrs:{class:"token selector"}},[t._v("[server]")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("DOMAIN")]),t._v("           "),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" git.gdzrch.win")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("ROOT_URL")]),t._v("         "),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" http://git.gdzrch.win/")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("START_SSH_SERVER")]),t._v(" "),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" true")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("SSH_LISTEN_HOST")]),t._v("  "),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 0.0.0.0")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("SSH_LISTEN_PORT")]),t._v("  "),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" 2022")]),t._v("\n\n")])]),a("p",[t._v("保存配置，重新运行"),a("code",[t._v("./gogs web")]),t._v("。这时，我们的gogs服务就运行在了"),a("code",[t._v("http://git.gdzrch.win/")]),t._v("域名下，ssh服务就运行在了"),a("code",[t._v("git.gdzrch.win")]),t._v("的"),a("code",[t._v("2022")]),t._v("端口。在使用git服务配置ssh的时候要注意端口的配置，不是默认的"),a("code",[t._v("22")]),t._v("端口。")]),a("h2",{attrs:{id:"nginx反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx反向代理","aria-hidden":"true"}},[t._v("#")]),t._v(" Nginx反向代理")]),a("p",[t._v("为了更好的性能，我们配置一下nginx反向代理。")]),a("p",[t._v("在`/etc/nginx/sites-available/目录下创建gogs文件，填入以下内容。")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("server "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen 80"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name git.gdzrch.win"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location / "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                proxy_pass http://127.0.0.1:3000"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("p",[a("code",[t._v("listen")]),t._v("是公网上暴露的端口，"),a("code",[t._v("server_name")]),t._v("是我们给gogs配置的域名，"),a("code",[t._v("proxy_pass")]),t._v("就是gogs运行的地址和端口。如果要通过域名子路径访问，可以修改"),a("code",[t._v("location")]),t._v("后的路径，比如"),a("code",[t._v("location /gogs/")]),t._v("，\n然后就可以通过"),a("code",[t._v("git.gdzrch.win/gogs")]),t._v("访问了。")]),a("h2",{attrs:{id:"守护进程服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#守护进程服务","aria-hidden":"true"}},[t._v("#")]),t._v(" 守护进程服务")]),a("p",[t._v("如过要以守护进程的方式运行gogs，可以配置"),a("code",[t._v("Systemd")]),t._v("服务。")]),a("p",[t._v("在"),a("code",[t._v("/etc/systemd/system/")]),t._v("目录下创建"),a("code",[t._v("gogs.service")]),t._v("文件，填入以下内容。")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unit"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nDescription"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("Gogs\nAfter"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("syslog.target\nAfter"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("network.target\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nType"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("simple\nUser"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("pi\nGroup"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("pi\nWorkingDirectory"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/pi/gogs\nExecStart"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/pi/gogs/gogs web\nRestart"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("always\nEnvironment"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("USER"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("pi HOME"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/pi\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Install"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nWantedBy"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("multi-user.target\n\n")])]),a("p",[t._v("通过"),a("code",[t._v("sudo systemctl enable gogs")]),t._v("激活，执行"),a("code",[t._v("sudo systemctl start gogs")]),t._v("启动gogs服务。")]),a("p",[t._v("还可以运行"),a("code",[t._v("sudo systemctl status gogs -l")]),t._v("查看当前gogs的状态。")]),a("p",[t._v("到此为止，基本完成了gogs服务在树莓派上的部署。更多的内容请查看"),a("a",{attrs:{href:"https://gogs.io/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档")]),t._v("。")])])}],!1,null,null,null);s.default=o.exports}}]);